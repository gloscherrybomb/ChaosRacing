<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>British National Circuit Series - General Classification Standings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: linear-gradient(135deg, #f4f1e8 0%, #e8dcc0 50%, #f4f1e8 100%);
            min-height: 100vh;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: #f4f1e8;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(44, 95, 95, 0.1);
            backdrop-filter: blur(10px);
            border: 3px solid #2c5f5f;
            overflow: hidden;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            gap: 0;
            padding: 0;
            min-height: 250px;
        }
        
        .header-image {
            flex: 0 0 40%;
            background-image: url('./banner.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #f4f1e8;
            border-radius: 15px 0 0 15px;
            min-height: 250px;
            position: relative;
        }
        
        .header-text {
            flex: 1;
            padding: 40px;
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background-color: #f4f1e8;
            border-radius: 0 15px 15px 0;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #2c5f5f;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.2;
        }
        
        .loading-message {
            background: rgba(44, 95, 95, 0.1);
            border: 2px solid rgba(44, 95, 95, 0.2);
            color: #2c5f5f;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .error-message {
            background: rgba(192, 57, 43, 0.1);
            border: 2px solid rgba(192, 57, 43, 0.3);
            color: #c0392b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
            display: none;
        }
        
        .rank-tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .tab-button {
            padding: 15px 25px;
            background: rgba(244, 241, 232, 0.9);
            border: 2px solid #2c5f5f;
            border-radius: 8px;
            color: #2c5f5f;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tab-button:hover {
            background: rgba(44, 95, 95, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 95, 95, 0.2);
        }
        
        .tab-button.active {
            background: #2c5f5f;
            color: #f4f1e8;
            box-shadow: 0 5px 20px rgba(44, 95, 95, 0.3);
        }
        
        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(44, 95, 95, 0.1);
            backdrop-filter: blur(10px);
            border: 3px solid #2c5f5f;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .results-summary {
            background: linear-gradient(135deg, #c0392b, #a93226);
            color: #f4f1e8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .filters-container {
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: 600;
            color: #2c5f5f;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .search-input, .filter-select {
            padding: 12px 20px;
            border: 2px solid #2c5f5f;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Georgia', serif;
            outline: none;
            transition: all 0.3s ease;
            background: #f4f1e8;
            color: #2c3e50;
        }
        
        .search-input {
            width: 300px;
            max-width: 100%;
        }
        
        .filter-select {
            width: 150px;
            cursor: pointer;
        }
        
        .search-input:focus, .filter-select:focus {
            border-color: #c0392b;
            box-shadow: 0 0 0 3px rgba(192, 57, 43, 0.1);
        }
        
        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(44, 95, 95, 0.15);
            border: 2px solid #2c5f5f;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 900px;
        }
        
        th {
            background: linear-gradient(135deg, #2c5f5f 0%, #1e4040 100%);
            color: #f4f1e8;
            padding: 15px 12px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            cursor: pointer;
            position: relative;
            user-select: none;
            font-family: 'Georgia', serif;
            line-height: 1.2;
            vertical-align: middle;
        }
        
        th:hover {
            background: linear-gradient(135deg, #1e4040 0%, #2c5f5f 100%);
        }
        
        th.sortable::after {
            content: " ‚Üï";
            opacity: 0.5;
            font-size: 11px;
            color: #c0392b;
        }
        
        th.sort-asc::after {
            content: " ‚Üë";
            opacity: 1;
            color: #c0392b;
        }
        
        th.sort-desc::after {
            content: " ‚Üì";
            opacity: 1;
            color: #c0392b;
        }
        
        /* Multi-line headers */
        .header-multiline {
            white-space: pre-line;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e8dcc0;
            font-size: 14px;
            font-family: 'Georgia', serif;
            text-align: center;
        }
        
        tr:nth-child(even) {
            background: rgba(232, 220, 192, 0.3);
        }
        
        tr:hover {
            background: rgba(44, 95, 95, 0.05);
        }
        
        .position-cell {
            font-weight: bold;
            font-size: 18px;
            color: #2c5f5f;
            text-align: center;
            width: 60px;
            vertical-align: middle;
            padding: 12px;
        }
        
        .position-1, .position-2, .position-3 {
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            margin: 0 auto;
            line-height: 1;
        }
        
        .position-1 { 
            color: #f1c40f; 
            background: rgba(241, 196, 15, 0.2);
        }
        .position-2 { 
            color: #95a5a6; 
            background: rgba(149, 165, 166, 0.2);
        }
        .position-3 { 
            color: #e67e22; 
            background: rgba(230, 126, 34, 0.2);
        }
        
        .name-cell {
            font-weight: 600;
            color: #2c5f5f;
            text-align: left;
        }
        
        .delta-cell {
            font-family: 'Courier New', monospace;
            font-weight: 500;
            color: #c0392b;
            text-align: right;
        }
        
        .missed-rounds {
            background: linear-gradient(135deg, #c0392b, #a93226);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .no-missed {
            color: #2e7d32;
            font-weight: 600;
        }
        
        .gender-male {
            color: #2980b9;
            font-weight: 600;
        }
        
        .gender-female {
            color: #8e44ad;
            font-weight: 600;
        }
        
        .sponsor-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(44, 95, 95, 0.1);
            backdrop-filter: blur(10px);
            border: 3px solid #2c5f5f;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }
        
        .sponsor-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .presented-by {
            font-size: 1.1rem;
            color: #2c5f5f;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .chaos-banner {
            height: 60px;
            width: auto;
        }
        
        .sponsor-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .racebook-link {
            background: linear-gradient(135deg, #c0392b, #a93226);
            color: #f4f1e8;
            padding: 15px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            border: 2px solid #c0392b;
        }
        
        .racebook-link:hover {
            background: linear-gradient(135deg, #a93226, #c0392b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(192, 57, 43, 0.3);
        }
        
        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header-content { 
                flex-direction: column; 
                text-align: center;
                padding: 20px;
                gap: 20px;
            }
            .header-image { 
                flex: none; 
                width: 100%;
                min-height: 150px;
                border-radius: 15px 15px 0 0;
            }
            .header-text { 
                text-align: center;
                padding: 20px;
                background-color: #f4f1e8;
                border-radius: 0 0 15px 15px;
            }
            .header h1 { font-size: 1.8rem; }
            .search-input { width: 250px; }
            .filter-select { width: 120px; }
            th, td { padding: 8px 6px; font-size: 12px; }
            .tab-button { padding: 12px 20px; font-size: 14px; }
            .filters-container { gap: 10px; }
            .filter-group { margin-bottom: 10px; }
            .sponsor-section {
                flex-direction: column;
                text-align: center;
                gap: 15px;
                padding: 20px;
            }
            .sponsor-left {
                justify-content: center;
            }
            .chaos-banner {
                height: 50px;
            }
            .racebook-link {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-image"></div>
                <div class="header-text">
                    <h1>General<br>Classification<br>Standings</h1>
                </div>
            </div>
        </div>

        <div class="sponsor-section">
            <div class="sponsor-left">
                <span class="presented-by">Presented by</span>
                <img src="./iVChaosBanner.png" alt="iV Chaos Racing" class="chaos-banner">
            </div>
            <div class="sponsor-right">
                <a href="eventschedule.html" class="racebook-link">üìÖ Event Schedule</a>
                <a href="index.html" class="racebook-link">üìñ View Racebook</a>
            </div>
        </div>

        <!-- REMOVE THIS SECTION WHEN USING REAL DATA -->
        <div class="placeholder-notice">
            ‚ö†Ô∏è Placeholder data - first event 6th October ‚ö†Ô∏è
        </div>
        <!-- END OF PLACEHOLDER NOTICE -->

        <div class="loading-message" id="loadingMessage">
            ‚è≥ Loading race results...
        </div>

        <div class="error-message" id="errorMessage">
            ‚ùå Error loading race results. Please check that CSV files are available.
        </div>

        <div class="rank-tabs" id="rankTabs" style="display: none;"></div>

        <div id="tabContents"></div>
    </div>

    <script>
        let loadedData = {};
        let currentSort = {};

        // List of CSV files to load (update this list with your actual CSV files)
        const csvFiles = [
            'GC_Diamond.csv',
            'GC_Platinum.csv', 
            'GC_Gold.csv',
            'GC_Silver.csv',
            'GC_Bronze.csv',
            'GC_Carbon.csv'
        ];

        // Load CSV files on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAllCSVFiles();
            checkBannerImage();
        });

        function checkBannerImage() {
            // Test if banner image exists
            const img = new Image();
            img.onload = function() {
                document.querySelector('.header-image').classList.add('loaded');
                console.log('‚úÖ Banner image loaded successfully');
            };
            img.onerror = function() {
                console.error('‚ùå Banner image not found. Please check that banner.png exists in the same directory as index.html');
                console.log('Expected path: ./banner.png');
                console.log('Current page URL:', window.location.href);
            };
            // Use relative path that matches the CSS
            img.src = './banner.png?' + Date.now();
        }

        async function loadAllCSVFiles() {
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            try {
                loadedData = {};
                let loadedCount = 0;
                
                for (let filename of csvFiles) {
                    try {
                        const response = await fetch(filename);
                        if (response.ok) {
                            const text = await response.text();
                            const data = parseCSV(text);
                            
                            if (data.length > 0) {
                                // Extract rank from filename (e.g., GC_Diamond.csv -> Diamond)
                                const rankMatch = filename.match(/GC_(.+)\.csv/i);
                                const rank = rankMatch ? rankMatch[1].replace('_', ' ') : filename.replace('.csv', '');
                                
                                loadedData[rank] = data;
                                loadedCount++;
                            }
                        }
                    } catch (fileError) {
                        console.warn(`Could not load ${filename}:`, fileError);
                    }
                }

                if (loadedCount > 0) {
                    displayResults();
                    loadingMessage.style.display = 'none';
                } else {
                    throw new Error('No CSV files could be loaded');
                }

            } catch (error) {
                console.error('Error loading CSV files:', error);
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'block';
            }
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            if (lines.length < 2) return [];

            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                if (values.length === headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    data.push(row);
                }
            }

            return data;
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim().replace(/"/g, ''));
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim().replace(/"/g, ''));
            return result;
        }

        function displayResults() {
            document.getElementById('rankTabs').style.display = 'flex';

            const tabsContainer = document.getElementById('rankTabs');
            const contentsContainer = document.getElementById('tabContents');
            
            tabsContainer.innerHTML = '';
            contentsContainer.innerHTML = '';

            // Sort ranks by typical cycling hierarchy
            const rankOrder = ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze', 'Carbon'];
            const sortedRanks = Object.keys(loadedData).sort((a, b) => {
                const aIndex = rankOrder.findIndex(r => a.toLowerCase().includes(r.toLowerCase()));
                const bIndex = rankOrder.findIndex(r => b.toLowerCase().includes(r.toLowerCase()));
                
                if (aIndex === -1 && bIndex === -1) return a.localeCompare(b);
                if (aIndex === -1) return 1;
                if (bIndex === -1) return -1;
                return aIndex - bIndex;
            });

            // Create tabs and content
            sortedRanks.forEach((rank, index) => {
                // Create tab button
                const tabButton = document.createElement('button');
                tabButton.className = `tab-button ${index === 0 ? 'active' : ''}`;
                tabButton.textContent = `${getRankEmoji(rank)} ${rank} (${loadedData[rank].length})`;
                tabButton.onclick = () => switchTab(rank);
                tabsContainer.appendChild(tabButton);

                // Get unique age bands for this rank
                const ageBands = [...new Set(loadedData[rank]
                    .map(rider => rider.AgeBand)
                    .filter(age => age && age.trim() !== '')
                )].sort();

                // Create age band options
                const ageBandOptions = ageBands.map(age => 
                    `<option value="${age}">${age}</option>`
                ).join('');

                // Create tab content
                const tabContent = document.createElement('div');
                tabContent.className = `tab-content ${index === 0 ? 'active' : ''}`;
                tabContent.id = `tab-${rank}`;
                
                tabContent.innerHTML = `
                    <div class="results-summary">
                        ${rank} Classification - ${loadedData[rank].length} Riders
                    </div>
                    <div class="filters-container">
                        <div class="filter-group">
                            <label class="filter-label">Search</label>
                            <input type="text" class="search-input" placeholder="üîç Search riders..." 
                                   oninput="filterTable('${rank}', this.value, getGenderFilter('${rank}'), getAgeBandFilter('${rank}'))">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Gender</label>
                            <select class="filter-select gender-filter" 
                                    onchange="filterTable('${rank}', getSearchValue('${rank}'), this.value, getAgeBandFilter('${rank}'))">
                                <option value="">All</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Age Group</label>
                            <select class="ageband-filter" 
                                    onchange="filterTable('${rank}', getSearchValue('${rank}'), getGenderFilter('${rank}'), this.value)">
                                <option value="">All Ages</option>
                                ${ageBandOptions}
                            </select>
                        </div>
                    </div>
                    ${createPodium(rank, loadedData[rank])}
                    <div class="table-container">
                        ${createTable(rank, loadedData[rank])}
                    </div>
                `;
                
                contentsContainer.appendChild(tabContent);
            });
        }

        function getRankEmoji(rank) {
            const rankLower = rank.toLowerCase();
            if (rankLower.includes('diamond')) return 'üíé';
            if (rankLower.includes('platinum')) return 'ü•à';
            if (rankLower.includes('gold')) return 'ü•á';
            if (rankLower.includes('silver')) return 'ü•à';
            if (rankLower.includes('bronze')) return 'ü•â';
            if (rankLower.includes('carbon')) return '‚ö´';
            return 'üèÜ';
        }

        function createTable(rank, data) {
            if (data.length === 0) {
                return '<div class="empty-state"><h3>No data available</h3></div>';
            }

            const headers = Object.keys(data[0]);
            const visibleHeaders = headers.filter(h => 
                !['UID', 'EventKey', 'Round'].includes(h)
            );

            let tableHTML = `<table id="table-${rank}">
                <thead>
                    <tr>`;

            visibleHeaders.forEach(header => {
                const sortable = ['Position', 'TotalDeltaTime', 'RoundsCompleted', 'MissedRounds', 'AverageDeltaTime'].includes(header);
                const displayHeader = formatHeaderText(header);
                
                tableHTML += `<th class="${sortable ? 'sortable' : ''} header-multiline" 
                              ${sortable ? `onclick="sortTable('${rank}', '${header}')"` : ''}>${displayHeader}</th>`;
            });

            tableHTML += `</tr></thead><tbody>`;

            data.forEach(row => {
                tableHTML += '<tr>';
                visibleHeaders.forEach(header => {
                    let cellContent = row[header] || '';
                    let cellClass = '';

                    if (header === 'Position') {
                        cellClass = 'position-cell';
                        if (cellContent === '1') {
                            cellContent = '<div class="position-1">1</div>';
                        } else if (cellContent === '2') {
                            cellContent = '<div class="position-2">2</div>';
                        } else if (cellContent === '3') {
                            cellContent = '<div class="position-3">3</div>';
                        }
                        // Don't add position-1/2/3 classes to the cell itself
                    } else if (header === 'Name') {
                        cellClass = 'name-cell';
                    } else if (header === 'Gender') {
                        cellClass = cellContent.toLowerCase() === 'male' ? 'gender-male' : 'gender-female';
                    } else if (header === 'TotalDeltaTime' || header === 'AverageDeltaTime') {
                        cellClass = 'delta-cell';
                        if (cellContent && !isNaN(cellContent)) {
                            cellContent = parseFloat(cellContent).toFixed(3) + 's';
                        }
                    } else if (header === 'MissedRounds') {
                        if (cellContent === '0' || cellContent === '') {
                            cellContent = '<span class="no-missed">0</span>';
                        } else {
                            cellContent = `<span class="missed-rounds">${cellContent}</span>`;
                        }
                    }

                    tableHTML += `<td class="${cellClass}">${cellContent}</td>`;
                });
                tableHTML += '</tr>';
            });

            tableHTML += '</tbody></table>';
            return tableHTML;
        }

        function formatHeaderText(header) {
            // Special cases for single words/phrases that shouldn't be split
            if (header === 'ARR') {
                return 'ARR';
            }
            if (header === 'ARRBand') {
                return 'ARR\nBand';
            }
            
            // Convert camelCase to separate words and add line breaks
            const formatted = header
                .replace(/([A-Z])/g, ' $1') // Add space before capital letters
                .replace(/^./, str => str.toUpperCase()) // Capitalize first letter
                .trim();
            
            // Split long headers into multiple lines
            if (formatted.includes(' ')) {
                return formatted.replace(/ /g, '\n');
            }
            return formatted;
        }

        function switchTab(rank) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab contents
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${rank}`).classList.add('active');
        }

        function sortTable(rank, column) {
            const data = loadedData[rank];
            const table = document.getElementById(`table-${rank}`);
            const header = table.querySelector(`th[onclick*="${column}"]`);
            
            // Determine sort direction
            let ascending = true;
            if (currentSort[rank] === column + '_asc') {
                ascending = false;
                currentSort[rank] = column + '_desc';
            } else {
                currentSort[rank] = column + '_asc';
            }

            // Clear all sort indicators
            table.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            // Add sort indicator
            header.classList.add(ascending ? 'sort-asc' : 'sort-desc');

            // Sort data
            data.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                // Convert to numbers if possible
                if (!isNaN(aVal) && !isNaN(bVal)) {
                    aVal = parseFloat(aVal);
                    bVal = parseFloat(bVal);
                } else {
                    aVal = String(aVal).toLowerCase();
                    bVal = String(bVal).toLowerCase();
                }

                if (aVal < bVal) return ascending ? -1 : 1;
                if (aVal > bVal) return ascending ? 1 : -1;
                return 0;
            });

            // Refresh table
            const tableContainer = document.querySelector(`#tab-${rank} .table-container`);
            tableContainer.innerHTML = createTable(rank, data);
        }

        function filterTable(rank, searchTerm, genderFilter, ageBandFilter) {
            const table = document.getElementById(`table-${rank}`);
            const rows = table.querySelectorAll('tbody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const rowText = row.textContent.toLowerCase();
                const nameCell = cells[1]; // Name column
                const genderCell = cells[4]; // Gender column  
                const ageBandCell = cells[cells.length - 1]; // AgeBand is last column
                
                // Check search term
                const matchesSearch = !searchTerm || rowText.includes(searchTerm.toLowerCase());
                
                // Check gender filter
                const matchesGender = !genderFilter || (genderCell && genderCell.textContent.trim() === genderFilter);
                
                // Check age band filter
                const matchesAge = !ageBandFilter || (ageBandCell && ageBandCell.textContent.trim() === ageBandFilter);
                
                const shouldShow = matchesSearch && matchesGender && matchesAge;
                row.style.display = shouldShow ? '' : 'none';
                
                if (shouldShow) visibleCount++;
            });
            
            // Update the results summary
            const summary = document.querySelector(`#tab-${rank} .results-summary`);
            if (summary) {
                const totalCount = loadedData[rank].length;
                if (visibleCount === totalCount) {
                    summary.textContent = `${rank} Classification - ${totalCount} Riders`;
                } else {
                    summary.textContent = `${rank} Classification - ${visibleCount} of ${totalCount} Riders`;
                }
            }
        }
        
        function getSearchValue(rank) {
            const searchInput = document.querySelector(`#tab-${rank} .search-input`);
            return searchInput ? searchInput.value : '';
        }
        
        function getGenderFilter(rank) {
            const genderSelect = document.querySelector(`#tab-${rank} .gender-filter`);
            return genderSelect ? genderSelect.value : '';
        }
        
        function getAgeBandFilter(rank) {
            const ageBandSelect = document.querySelector(`#tab-${rank} .ageband-filter`);
            return ageBandSelect ? ageBandSelect.value : '';
        }
    </script>
</body>
</html>
