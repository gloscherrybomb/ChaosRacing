<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Primavera - MSR Challenge by Chaos Racing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f5f1e8;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-image {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto 40px;
            display: block;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .button-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }

        .nav-button {
            background: linear-gradient(135deg, #009246 0%, #ce2b37 100%);
            color: white;
            padding: 18px 45px;
            text-decoration: none;
            font-size: 20px;
            font-weight: bold;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 3px solid #fff;
            cursor: pointer;
        }

        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
            filter: brightness(1.1);
        }

        .nav-button:active {
            transform: translateY(-1px);
        }

        .content-box {
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-width: 900px;
            margin: 0 auto;
        }

        .content-box h1 {
            color: #2d3e50;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
            letter-spacing: 0.5px;
            line-height: 1.4;
        }

        .content-box .intro {
            font-size: 18px;
            line-height: 1.7;
            color: #444;
            margin-bottom: 20px;
            text-align: center;
        }

        .features-list {
            list-style: none;
            margin-top: 30px;
            padding: 0;
        }

        .features-list li {
            font-size: 17px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 18px;
            padding-left: 35px;
            position: relative;
        }

        .features-list li:before {
            content: "\2022";
            color: #ce2b37;
            font-size: 24px;
            position: absolute;
            left: 0;
            top: -2px;
        }

        @media (max-width: 768px) {
            .button-row {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-button {
                text-align: center;
            }

            .content-box {
                padding: 30px 25px;
            }

            .content-box h1 {
                font-size: 24px;
            }

            .content-box .intro {
                font-size: 16px;
            }

            .features-list li {
                font-size: 15px;
            }
        }

        .filters {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: bold;
            color: #2d3e50;
            margin-bottom: 8px;
        }

        .filter-group select {
            padding: 10px 15px;
            border: 2px solid #009246;
            border-radius: 6px;
            font-size: 16px;
            background-color: white;
            cursor: pointer;
            min-width: 150px;
        }

        .filter-group select:hover {
            border-color: #ce2b37;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 30px;
        }

        #standingsTable {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
        }

        #standingsTable th {
            background: linear-gradient(135deg, #009246 0%, #ce2b37 100%);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            border-bottom: 3px solid #2d3e50;
            position: sticky;
            top: 0;
        }

        #standingsTable th:hover {
            background: linear-gradient(135deg, #006633 0%, #8b0000 100%);
        }

        #standingsTable td {
            padding: 12px 10px;
            border-bottom: 1px solid #ddd;
        }

        #standingsTable tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #standingsTable tr:hover {
            background-color: #f5f1e8;
        }

        .sort-indicator {
            font-size: 12px;
            margin-left: 5px;
        }

        @media (max-width: 768px) {
            .filters {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }

            .filter-group {
                align-items: stretch;
            }

            .filter-group select {
                width: 100%;
            }

            #standingsTable {
                font-size: 13px;
            }

            #standingsTable th,
            #standingsTable td {
                padding: 8px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <svg class="header-image" viewBox="0 0 1200 500" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#f5f1e8;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="greenStripe" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#009246;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#006633;stop-opacity:1" />
                </linearGradient>
                <linearGradient id="redStripe" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" style="stop-color:#ce2b37;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#8b0000;stop-opacity:1" />
                </linearGradient>
            </defs>
            
            <rect width="1200" height="500" fill="url(#skyGradient)"/>
            
            <g opacity="0.15">
                <line x1="600" y1="250" x2="0" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="200" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="400" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="600" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="800" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="1000" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="1200" y2="0" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="0" y2="500" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="200" y2="500" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="400" y2="500" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="800" y2="500" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="1000" y2="500" stroke="#fff" stroke-width="3"/>
                <line x1="600" y1="250" x2="1200" y2="500" stroke="#fff" stroke-width="3"/>
            </g>
            
            <polygon points="0,350 200,250 400,300 600,200 800,280 1000,220 1200,300 1200,500 0,500" fill="#4a7c59" opacity="0.6"/>
            <polygon points="0,400 150,320 350,360 550,280 750,340 950,300 1200,380 1200,500 0,500" fill="#2d5a3d" opacity="0.7"/>
            
            <path d="M 0,450 Q 300,430 600,440 Q 900,450 1200,435 L 1200,470 Q 900,485 600,475 Q 300,465 0,485 Z" fill="url(#greenStripe)"/>
            <path d="M 0,470 Q 300,455 600,465 Q 900,475 1200,460 L 1200,485 Q 900,500 600,490 Q 300,480 0,500 Z" fill="#ffffff"/>
            <path d="M 0,485 Q 300,470 600,480 Q 900,490 1200,475 L 1200,500 L 0,500 Z" fill="url(#redStripe)"/>
            
            <rect x="50" y="60" width="1100" height="120" fill="#2d3e50" opacity="0.85" rx="10"/>
            
            <text x="600" y="120" font-family="'Bebas Neue', 'Impact', Arial Black, sans-serif" font-size="52" font-weight="bold" fill="#fff" text-anchor="middle" letter-spacing="3">LA PRIMAVERA</text>
            
            <text x="600" y="160" font-family="'Helvetica Neue', Arial, sans-serif" font-size="32" font-weight="300" fill="#f5f1e8" text-anchor="middle" letter-spacing="4">MSR CHALLENGE BY CHAOS RACING</text>
            
            <rect x="450" y="170" width="100" height="8" fill="#009246"/>
            <rect x="550" y="170" width="100" height="8" fill="#fff"/>
            <rect x="650" y="170" width="100" height="8" fill="#ce2b37"/>
        </svg>

        <div class="button-row">
            <a href="#racebook" class="nav-button">Racebook</a>
            <a href="https://tpvirtualhub.com/series/327" class="nav-button" target="_blank">Schedule</a>
            <a href="#standings" class="nav-button" onclick="loadStandings(event)">Standings</a>
        </div>

        <div class="content-box">
            <h1>This December, Chaos Racing presents – La Primavera, MSR Challenge</h1>
            
            <p class="intro">The best 30km in professional cycling is now available to race on TrainingPeaks virtual.</p>
            
            <p class="intro">The rules are simple. With events scheduled throughout the month, simple take part and post your best possible finishing time on the course.</p>
            
            <p class="intro">The final 30km of the classic race has been carefully curated and checked for accuracy to give the most authentic experience possible. Attack on the Cipressa, or hold on and fight on the Poggio? The choice is up to you!</p>
            
            <ul class="features-list">
                <li>Take part as many times as you wish</li>
                <li>Events are scheduled in different slots throughout the month, so you should find an event that suits your schedule</li>
                <li>Pens are matchmade with 50 riders – as you improve, you will face faster bots (and humans) to work with</li>
                <li>Team up with friends and work together for the faster possible finish</li>
                <li>Your fastest time is posted to the leaderboard. The leaderboard is filterable by gender, age-group and ARR, so see how you stack up against your peers</li>
                <li>All events are tier 1 (smart trainer required) with performance verification on</li>
            </ul>
            
            <div style="text-align: center; margin-top: 40px;">
                <a href="index.html">
                    <img src="https://raw.githubusercontent.com/gloscherrybomb/ChaosRacing/main/iVChaosBanner.png" 
                         alt="Chaos Racing" 
                         style="width: 30%; max-width: 300px; height: auto;">
                </a>
            </div>
        </div>
    </div>

    <script>
        let standingsData = [];
        let currentSort = { column: null, ascending: true };

        function comingSoon(event) {
            event.preventDefault();
            alert('Coming Soon!');
        }

        async function loadStandings(event) {
            event.preventDefault();
            
            try {
                const response = await fetch('general_classification.csv');
                const csvText = await response.text();
                
                standingsData = parseCSV(csvText);
                
                // Replace content with standings table
                const contentBox = document.querySelector('.content-box');
                contentBox.innerHTML = `
                    <h1>General Classification Standings</h1>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label for="genderFilter">Gender:</label>
                            <select id="genderFilter" onchange="applyFilters()">
                                <option value="">All</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="ageFilter">Age Cat:</label>
                            <select id="ageFilter" onchange="applyFilters()">
                                <option value="">All</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="arrFilter">ARR Rank:</label>
                            <select id="arrFilter" onchange="applyFilters()">
                                <option value="">All</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="standingsTable">
                            <thead>
                                <tr id="tableHeaders"></tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                `;
                
                populateFilters();
                displayStandings(standingsData);
            } catch (error) {
                alert('Error loading standings data. Please ensure general_classification.csv is in the same directory as this page.');
                console.error('Error:', error);
            }
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            return lines.slice(1).map(line => {
                const values = line.split(',').map(v => v.trim());
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index];
                });
                return row;
            });
        }

        function populateFilters() {
            const genders = [...new Set(standingsData.map(r => r.Gender))].filter(Boolean).sort();
            const ages = [...new Set(standingsData.map(r => r.AgeBand))].filter(Boolean).sort();
            const arrs = [...new Set(standingsData.map(r => r.ARRBand))].filter(Boolean).sort();
            
            const genderFilter = document.getElementById('genderFilter');
            genders.forEach(gender => {
                const option = document.createElement('option');
                option.value = gender;
                option.textContent = gender;
                genderFilter.appendChild(option);
            });
            
            const ageFilter = document.getElementById('ageFilter');
            ages.forEach(age => {
                const option = document.createElement('option');
                option.value = age;
                option.textContent = age;
                ageFilter.appendChild(option);
            });
            
            const arrFilter = document.getElementById('arrFilter');
            arrs.forEach(arr => {
                const option = document.createElement('option');
                option.value = arr;
                option.textContent = arr;
                arrFilter.appendChild(option);
            });
        }

        function applyFilters() {
            const genderFilter = document.getElementById('genderFilter').value;
            const ageFilter = document.getElementById('ageFilter').value;
            const arrFilter = document.getElementById('arrFilter').value;
            
            let filtered = standingsData.filter(row => {
                return (!genderFilter || row.Gender === genderFilter) &&
                       (!ageFilter || row.AgeBand === ageFilter) &&
                       (!arrFilter || row.ARRBand === arrFilter);
            });
            
            displayStandings(filtered);
        }

        function displayStandings(data) {
            if (data.length === 0) return;
            
            const headers = Object.keys(data[0]);
            const tableHeaders = document.getElementById('tableHeaders');
            const tableBody = document.getElementById('tableBody');
            
            // Create headers with sort functionality
            tableHeaders.innerHTML = '';
            headers.forEach(header => {
                const th = document.createElement('th');
                let displayName = header;
                
                // Rename headers as requested
                if (header === 'ARRBand') displayName = 'ARR Rank';
                else if (header === 'EventRating') displayName = 'Course Rating';
                else if (header === 'AgeBand') displayName = 'Age Cat';
                
                th.innerHTML = `${displayName} <span class="sort-indicator"></span>`;
                th.onclick = () => sortTable(header);
                th.style.cursor = 'pointer';
                tableHeaders.appendChild(th);
            });
            
            // Populate table body
            tableBody.innerHTML = '';
            data.forEach(row => {
                const tr = document.createElement('tr');
                headers.forEach(header => {
                    const td = document.createElement('td');
                    td.textContent = row[header];
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }

        function sortTable(column) {
            const genderFilter = document.getElementById('genderFilter').value;
            const ageFilter = document.getElementById('ageFilter').value;
            const arrFilter = document.getElementById('arrFilter').value;
            
            let filtered = standingsData.filter(row => {
                return (!genderFilter || row.Gender === genderFilter) &&
                       (!ageFilter || row.AgeBand === ageFilter) &&
                       (!arrFilter || row.ARRBand === arrFilter);
            });
            
            // Toggle sort direction
            if (currentSort.column === column) {
                currentSort.ascending = !currentSort.ascending;
            } else {
                currentSort.column = column;
                currentSort.ascending = true;
            }
            
            filtered.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                // Try to parse as numbers
                const aNum = parseFloat(aVal);
                const bNum = parseFloat(bVal);
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return currentSort.ascending ? aNum - bNum : bNum - aNum;
                }
                
                // String comparison
                if (currentSort.ascending) {
                    return aVal.localeCompare(bVal);
                } else {
                    return bVal.localeCompare(aVal);
                }
            });
            
            displayStandings(filtered);
            updateSortIndicators();
        }

        function updateSortIndicators() {
            document.querySelectorAll('.sort-indicator').forEach(indicator => {
                indicator.textContent = '';
            });
            
            const headers = document.querySelectorAll('#tableHeaders th');
            const headerTexts = Array.from(headers).map(h => h.textContent.replace(' ▲', '').replace(' ▼', '').trim());
            
            headers.forEach((th, index) => {
                let headerName = Object.keys(standingsData[0])[index];
                if (headerName === currentSort.column) {
                    const indicator = th.querySelector('.sort-indicator');
                    indicator.textContent = currentSort.ascending ? ' ▲' : ' ▼';
                }
            });
        }
    </script>
</body>
</html>
